<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API</title>
</head>

<body>
    <h1>Input Data ke Google Sheets</h1>
    <form id="sheetForm">
        <label for="col1">Kolom 1:</label>
        <input type="text" id="col1" name="col1" required><br><br>

        <label for="col2">Kolom 2:</label>
        <input type="text" id="col2" name="col2" required><br><br>

        <input type="submit" value="Submit">
    </form>

    <p id="status"></p>

    <h1>Data dari Google Sheets</h1>
    <table id="data-table" border="1">
        <thead>
            <tr>
                <th>Kolom 1</th>
                <th>Kolom 2</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data dari Google Sheets akan ditampilkan di sini -->
        </tbody>
    </table>

    <script>
        const form = document.getElementById('sheetForm');
        const status = document.getElementById('status');

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const col1 = document.getElementById('col1').value;
            const col2 = document.getElementById('col2').value;

            const data = {
                values: [
                    [col1, col2] // Sesuaikan dengan urutan kolom yang ada di Google Sheets
                ]
            };

            fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}:append?valueInputOption=USER_ENTERED&key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    if (data.updates) {
                        status.textContent = 'Data berhasil ditambahkan!';
                    } else {
                        status.textContent = 'Terjadi kesalahan. Data tidak dapat ditambahkan.';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    status.textContent = 'Terjadi kesalahan saat mengirim data.';
                });
        });

        // Ambil data dari Google Sheets
        const apiKey = 'AIzaSyDLNmmArsNZAaoHe02bWWN4atQxX9dSLvE'; // API Key Anda
        const spreadsheetId = '1FrPDzbrbCWAcDTcxo2zmZeVd3rYiNmctYp7y1IBdmE0'; // Spreadsheet ID
        const range = 'Sheet1'; // Range data yang ingin diambil

        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
                const rows = data.values;

                rows.forEach(row => {
                    let newRow = tableBody.insertRow();

                    row.forEach(cell => {
                        let newCell = newRow.insertCell();
                        newCell.textContent = cell;
                    });
                });
            })
            .catch(error => console.error('Error fetching data: ', error));
    </script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        let gapiInited = false;
        let gisInited = false;
        let tokenClient;

        // Masukkan Client ID Anda
        const CLIENT_ID = '264162810702-mc680tlohmis892b0jsrlqm3vlmk6o1v.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyDLNmmArsNZAaoHe02bWWN4atQxX9dSLvE'; // Anda bisa mengosongkan jika tidak menggunakan API Key
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        const SPREADSHEET_ID = '1FrPDzbrbCWAcDTcxo2zmZeVd3rYiNmctYp7y1IBdmE0';

        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // Callback yang akan dipanggil setelah mendapatkan token
            });
            gisInited = true;
        }

        document.getElementById('sheetForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const col1 = document.getElementById('col1').value;
            const col2 = document.getElementById('col2').value;

            if (!gapiInited || !gisInited) {
                console.log('Google API client belum diinisialisasi');
                return;
            }

            tokenClient.callback = async (resp) => {
                if (resp.error) {
                    throw (resp);
                }

                const data = {
                    values: [
                        [col1, col2]
                    ]
                };

                try {
                    const response = await gapi.client.sheets.spreadsheets.values.append({
                        spreadsheetId: SPREADSHEET_ID,
                        range: 'Sheet1',
                        valueInputOption: 'USER_ENTERED',
                        resource: data,
                    });
                    document.getElementById('status').textContent = 'Data berhasil ditambahkan!';
                    console.log(response);
                } catch (err) {
                    document.getElementById('status').textContent = 'Terjadi kesalahan. Data tidak dapat ditambahkan.';
                    console.error('Error: ' + err.result.error.message);
                }
            };

            if (gapi.client.getToken() === null) {
                // Request token if not already available
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } else {
                // Token available; call the API
                tokenClient.callback();
            }
        });

        // Muat client dan token setelah Google API library dimuat
        gapiLoaded();
        gisLoaded();
    </script>

</body>

</html>